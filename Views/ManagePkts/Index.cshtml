@model IEnumerable<Pkt.Models.Entites.ManagePkt>
       
@{
    ViewData["Title"] = "PKT List";
}
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                
                <div class="card card-info">
                    <div class="card-header">
                        <h2 class="card-title"><b>PKT List</b></h2>
                        <p class="float-right">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-default">
                                Add New
                            </button>
                            @*data-toggle="modal" data-target="#modal-default"*@
                        </p>
                    </div>
                    @if (ViewBag.Success != null)
                    {
                        <div class="alert alert-success alert-dismissible">
                            <strong>Great !</strong> @ViewBag.Success
                        </div>
                    }
                    <!-- /.card-header -->
                    <div class="card-body">
                        <table id="example2" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                     <th>Sr. No.</th>
                                     <th>Name</th>
                                     <th>TestDuration(In Minutes)</th>
                                     <th>Process</th>
                                     <th>CreatedBy</th>
                                     <th>Created On</th>
                                 </tr>
                            </thead>
                            <tbody>
                                @{
                                    int index = 1;
                                }
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@index</td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Name)
                                        </td>
                                        <td>
                                            <span class="badge badge-info"> <i class="fas fa-clock"></i>&nbsp; @Html.DisplayFor(modelItem => item.TestDuration)&nbsp; Minutes</span>
                                        </td>
                                     
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Process)
                                        </td>
                                         <td>
                                           <span class="badge badge-success"><i class="fas fa-user"></i> &nbsp; @Html.DisplayFor(modelItem => item.CreatedBy)</span>
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.CreatedOn)
                                        </td>
                                      
                                    </tr>
                                    index++;
                                    
                                }
                             </tbody>
                         </table>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
             </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
</section>

<div class="modal fade" id="modal-default">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add PKT</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body card card-primary">
                <form id="quickForm" asp-action="Create">
                     <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Process</label>
                                <select class="form-select select2bs4" name="process" id="process" style="width: 100%;">
                                    <option value="">Please Select Process</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputPassword1">PKT Name</label>
                                <input type="text" name="name" class="form-control" id="name" placeholder="enter pkt name">
                            </div>
                           
                         </div>

                        <div class="col-md-6" data-select2-id="30">
                            
                            @* <div class="form-group">
                                <label>PKT For</label>
                                <select class="form-select select2bs4" name="pktfor" id="pktfor" style="width: 100%;">
                                    <option value="">Please Select For</option>
                                    <option value="All">All</option>
                                </select>
                            </div> *@

                            <div class="form-group">
                                <label for="exampleInputEmail1">Duration (In Minutes)</label>
                                <input type="number" name="duration" class="form-control" id="duration" placeholder="Enter Duration in minutes">
                            </div>
                         </div>
                      </div>

                        <div class="card-footer">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </form>
             </div>
            <div class="modal-footer justify-content">
                @* <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> *@
                <button type="button" class="btn btn-danger float-md-right" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@section Scripts{
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(function () {

            $.ajax({
                url: '/ManagePkts/GetProcess',
                type: 'GET',
                success: function (response) {
                    $.each(response, function (key, val) {
                        $('#process').append('<option value="' + val.id + '">' + val.clientName + '|' + val.processName + '|' + val.processName + '</option> ')
                    });
                }
            });
         
            $('#quickForm').validate({
                rules: {
                    name: {
                        required: true,
                        minlength: 5
                    },
                    duration: {
                        required: true
                    },
                    process: {
                        required:true
                    },
                },
                messages: {
                    process: {
                        required: "Please Select Process name"
                    },
                    name: {
                        required: "Please provide a PKT name",
                        minlength: "Your PKTName must be at least 5 characters long"
                    },
                    duration: "Please enter duration in minutes"
                },
                errorElement: 'span',
                errorPlacement: function (error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function (element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function (element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                }
            });
        });
    </script>

    <script type="text/javascript">
        $("#quickForm").on("submit", function (e) {
            e.preventDefault();

            if ($("#quickForm").valid()) {

                $.ajax({
                    type: "post",
                    url: $(this).attr('action'),
                    dataType: 'text',
                    headers: { "RequestVerificationToken": '@Html.AntiForgeryToken()' },
                    data: {
                        Name: $('#name').val(),
                        TestDuration: $('#duration').val(),
                        Cm_Id: $('#process').val(),
                        Process: $('#process option:selected').text(),
                    
                    },
                    success: function (response) {
                        obj = JSON.parse(response);
                        if (obj.success) {
                            toastr.success(obj.message);
                            setTimeout(function () {
                                $('#modal-default').modal('hide');
                                location.reload();
                            }, 1000);
                        }

                        if (obj.error) {
                            toastr.error(obj.message);
                        }
                            
                        
                    },
                    
                });

            }
            else {
                return false;
            }
            
           
        });
    </script>
            }