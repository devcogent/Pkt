@model IEnumerable<Pkt.Models.Entites.CommonQuestion>
@{
    ViewData["Title"] = "Manage Question";
}
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">

                <div class="card card-info">
                    <div class="card-header">
                        <h2 class="card-title"><b>Add Question</b></h2>
                        <p class="float-right">
                          @*<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-default">
                                Add New
                            </button> *@
                            @*data-toggle="modal" data-target="#modal-default"*@
                        </p>
                    </div>
                    @if (ViewBag.Success != null)
                    {
                        <div class="alert alert-success alert-dismissible">
                            <strong>Great !</strong> @ViewBag.Success
                        </div>
                    }
                    <!-- /.card-header -->
                    <div class="card-body">
                        <div class="modal-body card">
                            <form id="quickForm" asp-action="Create" enctype="multipart/form-data" method="post">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>PKT NAME</label>
                                            <select class="form-control form-select select2bs4" name="PKTName" id="pktname" style="width: 100%;">
                                                <option value="">Please Select PKT Name</option>
                                                
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6" data-select2-id="30">
                                        <div class="form-group">
                                            <label>UPLOAD TYPE</label>
                                            <select class="form-control select2bs4" name="UploadType" id="pktfor" style="width: 100%;">
                                                <option value="">Please Select For</option>
                                                <option value="Upload">Upload</option>
                                                <option value="Manual">Manual</option>
                                                <option value="Question Bank">Question Bank</option>
                                            </select>
                                        </div>
                                     </div>
                                </div>




                                        <!-- /.row  table row -->
                                        <div class="row questionDiv">
                                            <div class="col-12">
                                                <div class="card">
                                                  <div class="card-body">
                                                        <table id="example2" class="table table-bordered table-hover">
                                                            <thead>
                                                                <tr>
                                                                    <th>
                                                                <input class="form-group" type="checkbox" id="checkAll">
                                                                    </th>
                                                                    <th>
                                                                        @Html.DisplayNameFor(model => model.Question)
                                                                    </th>
                                                                    <th>
                                                                        @Html.DisplayNameFor(model => model.Option1)
                                                                    </th>
                                                                    <th>
                                                                        @Html.DisplayNameFor(model => model.Option2)
                                                                    </th>
                                                                    <th>
                                                                        @Html.DisplayNameFor(model => model.Option3)
                                                                    </th>
                                                                    <th>
                                                                        @Html.DisplayNameFor(model => model.Option4)
                                                                    </th>
                                                                    <th>
                                                                        @Html.DisplayNameFor(model => model.Answer)
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @{
                                                                    int index = 1;
                                                                }
                                                                @foreach (var item in Model)
                                                                {
                                                                    <tr>
                                                                <td>

                                                                    <input type="checkbox" class="form-group checkbox"  name="Ques" value="@item.Id">

                                                                @* <td>@Html.CheckBoxFor(modelItem => Id.Checked)</td> *@
                                                                </td>
                                                                        <td>
                                                                            @Html.DisplayFor(modelItem => item.Question)
                                                                        </td>
                                                                        <td>
                                                                            @Html.DisplayFor(modelItem => item.Option1)
                                                                        </td>
                                                                        <td>
                                                                            @Html.DisplayFor(modelItem => item.Option2)
                                                                        </td>
                                                                        <td>
                                                                            @Html.DisplayFor(modelItem => item.Option3)
                                                                        </td>
                                                                        <td>
                                                                            @Html.DisplayFor(modelItem => item.Option4)
                                                                        </td>   
                                                                        <td>
                                                                            @Html.DisplayFor(modelItem => item.Answer)
                                                                        </td>

                                                                        
                                                                    </tr>

                                                                    index++;

                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- /.card-body -->
                                                </div>
                                                <!-- /.card -->

                                            </div>
                                            <!-- /.col -->
                                        </div>
                                         <!-- /.row table row close-->
                                <!-- /.row upload file row open-->
                                        <div class="row uploadDiv">

                                    <div class="col-md-12">

                                        <div class="card card-default">
                                           @*  <div class="card-header">
                                                <h3 class="card-title"><b>Add Common Question</b></h3>
                                            </div> *@


@*                                             <form runat="server" id="quickForm" method="post" action="/CommonQuestions/UploadExcel" enctype="multipart/form-data">
 *@                                                <div class="card-body row">
                                                    <div class="form-group col-md-6 col-lg-6">
                                                    <label for="exampleInputEmail1">Excel File</label><span class="text-danger">*</span>
                                                        <input type="file" name="file" class="form-control" accept=".xlsx, .xls, .csv" id="exampleInputEmail1">
                                                    </div>
                                                    <div class="form-group col-md-3 col-lg-3">
                                                        &nbsp;<label for="exampleInputEmail1"> </label>
                                                        <div class="mt-2">
                                                            &nbsp; &nbsp; <a href="~/dist/UploadFormatePapper.csv" title="upload format"><i class="fa fa-download" aria-hidden="true"> &nbsp; Download Format</i></a>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-3 col-lg-3">
                                                        @* <div class="mt-4">
                                                            <button type="submit" class="btn btn-primary">Submit</button>
                                                        </div> *@
                                                    </div>
                                                </div>
                                            @* </form> *@
                                        </div>

                                    </div>

                                </div>
                                <!-- /.row upload file row close-->

                                <div class="row manualDiv">
                                     <div class="col-md-12">
                                        <div class="card card-default">
                                             <div class="card-body">
                                                <div class="form-group">
                                                    <label for="exampleInputEmail1">Question</label><span class="text-danger">*</span>
                                                    <input type="text" name="Question" class="form-control" id="Question" placeholder="Enter Question">
                                                </div>
                                                <div class="form-group">
                                                    <label for="exampleInputEmail1">Option 1</label><span class="text-danger">*</span>
                                                    <input type="text" name="Option1" class="form-control" id="Option1" placeholder="Enter Option-1">
                                                </div>
                                                <div class="form-group">
                                                    <label for="exampleInputEmail1">Option 2</label><span class="text-danger">*</span>
                                                    <input type="text" name="Option2" class="form-control" id="Option2" placeholder="Enter Option-2">
                                                </div>
                                                <div class="form-group">
                                                    <label for="exampleInputEmail1">Option 3</label><span class="text-danger">*</span>
                                                    <input type="text" name="Option3" class="form-control" id="Option3" placeholder="Enter Option-3">
                                                </div>
                                                <div class="form-group">
                                                    <label for="exampleInputEmail1">Option 4</label><span class="text-danger">*</span>
                                                    <input type="text" name="Option4" class="form-control" id="Option4" placeholder="Enter Option-4">
                                                </div>
                                                <div class="form-group">
                                                    <label for="exampleInputEmail1">Correct Answer</label><span class="text-danger">*</span>
                                                    <input type="number" name="Answer" class="form-control" id="Answer" placeholder="type here 1 if Option 1 is Correct, 2 if Option 2 is Correct">
                                                </div>
                                                <div class="form-group">
                                                    @* <div class="mt-4">
                                                    <button type="submit" class="btn btn-primary">Submit</button>
                                                    </div> *@
                                                </div>
                                            </div>
                                        </div>
                                     </div>
                                 </div>

                                    <div class="card-footer">
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->

        <div class="row questionList">
            <div class="col-12">
                <div class="card card-info">
                    <div class="card-header">
                        <h2 class="card-title"><b>View Question</b></h2>

                    </div>

                    <div class="card-body">
                        <table id="QuesTable" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>
                                        PKT Name
                                    </th>
                                    <th>
                                        Upload Type
                                    </th>
                                    <th>
                                        Question
                                    </th>
                                    <th>
                                        Answer
                                    </th>
                                    <th>
                                        Created On
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->

            </div>
            <!-- /.col -->
        </div>
    </div>
    <!-- /.container-fluid -->
</section>







<div class="modal fade" id="modal-default">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Update PKT-Question</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body card card-primary">
                
                    <form id="updateForm" action="/ManagePkts/UpdateQuestion/" method="POST" >
                        <input type="hidden" name="Id" id="Id"/>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>PKT NAME</label>
                                        <input class="form-control" name="Updatepktname" id="Updatepktname" readonly />
                                    </div>
                                </div>
                               
                                <div class="col-md-6" data-select2-id="30">
                                    <div class="form-group">
                                        <label>UPLOAD TYPE</label>
                                        <select class="form-control select2bs4" name="UpdateUploadType" id="UpdateUploadType" style="width: 100%;">
                                            <option value="">Please Select For</option>
                                            <option value="Upload">Upload</option>
                                            <option value="Manual">Manual</option>
                                            <option value="Question Bank">Question Bank</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Question</label><span class="text-danger">*</span>
                            <input type="text" name="UpdateQuestion" class="form-control" id="UpdateQuestion" placeholder="Enter Question">
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Option 1</label><span class="text-danger">*</span>
                            <input type="text" name="UpdateOption1" class="form-control" id="UpdateOption1" placeholder="Enter Option-1">
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Option 2</label><span class="text-danger">*</span>
                            <input type="text" name="UpdateOption2" class="form-control" id="UpdateOption2" placeholder="Enter Option-2">
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Option 3</label><span class="text-danger">*</span>
                            <input type="text" name="UpdateOption3" class="form-control" id="UpdateOption3" placeholder="Enter Option-3">
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Option 4</label><span class="text-danger">*</span>
                            <input type="text" name="UpdateOption4" class="form-control" id="UpdateOption4" placeholder="Enter Option-4">
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Correct Answer</label><span class="text-danger">*</span>
                            <input type="number" name="UpdateAnswer" class="form-control" id="UpdateAnswer" placeholder="type here 1 if Option 1 is Correct, 2 if Option 2 is Correct">
                            </div>
                            <div class="form-group">
                                <div class="mt-4">
                                    <button type="submit" class="btn btn-primary">Update Question</button>
                                </div>
                            </div>
                        </div>
                    </form>
                
            </div>
            <div class="modal-footer justify-content">
                @* <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> *@
                <button type="button" class="btn btn-danger float-md-right" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>



@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
     }
    
    <script>


        var baseUrl = window.location.origin;
        var controllerUrl = baseUrl;
        const urlObject = new URL(baseUrl);
        const hasPort = urlObject.port !== "" && !isNaN(parseInt(urlObject.port));

        if (hasPort) {
            controllerUrl = baseUrl;
        }
        else {
            controllerUrl = baseUrl + '/pkt';
        }


        var checkAllCheckbox = document.getElementById('checkAll');
        var checkboxes = document.getElementsByClassName('checkbox');
        checkAllCheckbox.addEventListener('change', function () {
            for (var i = 0; i < checkboxes.length; i++) {
                checkboxes[i].checked = this.checked;
            }
        });
       
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].addEventListener('change', function () {
            if (!this.checked){checkAllCheckbox.checked = false;}
            });
        }

     $('#pktname').on('change', function () {
            $('#formId').show();
            $('.manualEditDiv').hide();
        });

        function edit(id) {
            $.ajax({
                url: controllerUrl + '/ManagePkts/EditQuestion/' + id,
                type: 'get',
                success: function (response) {
                    if (response.error) {
                        $('.manualEditDiv').hide();
                        toastr.error(response.message);
                    }else{
                        $('#UpdateQuestion').val(response.question);
                        $('#UpdateOption1').val(response.option1);
                        $('#UpdateOption2').val(response.option2);
                        $('#UpdateOption3').val(response.option3);
                        $('#UpdateOption4').val(response.option4);
                        $('#UpdateAnswer').val(response.answer);
                        $('#Id').val(response.id);
                        $('#Updatepktname').val(response.pktName);
                        $('#UpdateUploadType').val(response.uploadType).change();
                        $('#modal-default').modal('show');
                    }
                    
                    
                }
            });
        }

        function deleteQuestion(id)
        {
            if (confirm("Are You Sure Want To delete ?")) 
            { 
                $.ajax({
                    url: controllerUrl + '/ManagePkts/DeleteQuestion/'+id,
                    type: 'get',
                    success: function (response) {
                        if (response.success) {
                            toastr.success(response.message);
                            setTimeout(function () {
                                
                                location.reload();
                            }, 1000);
                        }

                        if (response.error) {
                            toastr.error(response.message);
                        }
                    }
                });
            }
        }

        $(function () {

            $('.manualEditDiv').hide();

            $('.questionList').hide();
            $.ajax({
                url: controllerUrl + "/ManagePkts/GetPktList",
                type:'get',
                success: function (response) {
                    $.each(response, function (item , value) {
                        $('#pktname').append('<Option value="' + value.name + '">' + value.name + '</Option>');
                    });
                }
             });

            $('#pktname').on('change', function () {

                if ($(this).val() == "")
                {
                    $('.questionList').hide();
                }
                  $.ajax({
                    url: controllerUrl + '/ManagePkts/QuestionList',
                    type:'POST',
                    dataType: 'text',
                    headers: { "RequestVerificationToken": '@Html.AntiForgeryToken()' },
                    data: {
                        PKTName: $(this).val(),
                    },
                    success: function (response) {
                        if (response.length > 0) {
                            $('.questionList').show();
                            var jsonArray = JSON.parse(response);
                            var html = '';
                            $.each(jsonArray, function (key, val) {
                                html += '<tr>' +
                                    '<td>' + val.pktName + '</td>' +
                                    '<td>' + val.uploadType + '</td>' +
                                    '<td>' + val.question + '</td>' +
                                    '<td>' + val.answer + '</td>' +
                                    '<td>' + val.createdOn + '</td>' +
                                    '<td><a href="javascript:void(0)" onclick="edit(' + val.id + ');"><i class="fas fa-edit editQuestion"></i></a>&nbsp; <a href="javascript:void(0)" onclick="deleteQuestion(' + val.id + ');"  id="' + val.id + '"> <i class="fas fa-trash"></i></a></td>'
                                    +'</tr>';
                            });
                            $('#QuesTable tbody').html(html);
                            $('#QuesTable').DataTable();
                         }
                     }
                });
            
            });


            
            

            $('.uploadDiv').hide();
            $('.questionDiv').hide();
            $('.manualDiv').hide();
            

            $('#pktfor').on('change', function () {
                 var pktfor = $(this).val();
                if (pktfor == 'Upload') {
                    $('.uploadDiv').show();
                    $('.questionDiv').hide();
                    $('.manualDiv').hide();
                }
                if (pktfor == 'Question Bank') {
                    $('.uploadDiv').hide();
                    $('.questionDiv').show();
                    $('.manualDiv').hide();
                }
                if (pktfor == 'Manual') {
                    $('.uploadDiv').hide();
                    $('.questionDiv').hide();
                    $('.manualDiv').show();
                }
                if (pktfor == '') {
                    $('.uploadDiv').hide();
                    $('.questionDiv').hide();
                    $('.manualDiv').hide();
                }

            });


            $('#updateForm').validate({
                rules: {
                    UpdateQuestion: {
                        required: true,
                    },
                    UpdateOption1: {
                        required: true,
                    },
                    UpdateOption2: {
                        required: true,
                    },
                    UpdateOption3: {
                        required: true,
                    },
                    UpdateOption4: {
                        required: true,
                    },
                    UpdateAnswer: {
                        required: true,
                    },
                    Updatepktname: {
                        required: true,
                    },
                    UpdateUploadType: {
                        required: true,
                    }
                 },
                errorElement: 'span',
                errorPlacement: function (error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function (element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function (element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                }
            });



            $('#quickForm').validate({
                rules: {
                    UploadType: {
                        required: true,
                    },
                    PKTName: {
                        required: true,
                    },
                    file: {
                        required:true,
                    },
                    Question: {
                        required :true,
                    },
                     Option1: {
                        required :true,
                    },
                    Option2: {
                        required :true,
                    },
                    Option3: {
                        required: true,
                    },
                    Option4: {
                        required: true,
                    },
                    Answer: {
                        required: true,
                    },
                    Ques: {
                        required :true,
                    }


                },
                messages: {
                    UploadType: {
                        required: "Please Select Upload Type"
                    },
                    PKTName: {
                        required: "Please enter a PKT name",
                     },
                    file: {
                        required: "Please select a excel file",
                    }, Question: {
                        required: "Please Enter Question ",
                    }
                    
                  
                },
                errorElement: 'span',
                errorPlacement: function (error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function (element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function (element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                }
            });


           

        });
    </script>


        

    <script type="text/javascript">
        $("#updateForm").on("submit", function (e) {
            e.preventDefault();

            if ($("#updateForm").valid()) {

                $.ajax({
                    type: "post",
                    url: controllerUrl + $(this).attr('action'),
                    dataType: 'text',
                    headers: { "RequestVerificationToken": '@Html.AntiForgeryToken()' },
                    data: {
                        Id : $('#Id').val(),
                        PKTName : $('#Updatepktname').val(),
                        Question : $('#UpdateQuestion').val(),
                        UploadType: $('#UpdateUploadType').val(),
                        Option1: $('#UpdateOption1').val(),
                        Option2: $('#UpdateOption2').val(),
                        Option3: $('#UpdateOption3').val(),
                        Option4: $('#UpdateOption4').val(),
                        Answer: $('#UpdateAnswer').val()
                     },
                    success: function (xhr, status, error) {



                        if (status=='success') {
                            toastr.success("Question Updated Successfully !");
                            setTimeout(function () {
                                $('#modal-default').modal('hide');
                                location.reload();
                            }, 1000);
                        }

                        if (response.error) {
                            toastr.error(response.message);
                        }


                    },

                });

            }
            else {
                return false;
            }


        });
    </script>
}
